<style>
img.gallery { width:100px; height:100px; padding:0px; border:0px; margin:0px; }
</style>
<h1 id="nutanix-zenpack">Nutanix ZenPack</h1>
<p>This ZenPack provides system monitoring of Nutanix.</p>
<h2 id="support">Support</h2>
<p>This ZenPack is included with commercial versions of Zenoss and enterprise support for this ZenPack is provided to Zenoss customers with an active subscription.</p>
<h2 id="releases">Releases</h2>
<dl>
<dt>Version 1.0.1-<a rel="nofollow" class="external" href="https://zenoss.leapfile.net">Download</a></dt>
<dd>Released on 2017/11/14
</dd>
<dd>Requires <a href="http://zenoss.com/product/zenpacks/pythoncollector">PythonCollector ZenPack</a>,<a href="http://zenoss.com/product/zenpacks/zenpacklib">ZenPackLib ZenPack</a>
</dd>
<dd>Compatible with Zenoss Resource Manager 5.2 - 6.0
</dd>
<dt>Version 1.0.0-<a rel="nofollow" class="external" href="https://zenoss.leapfile.net">Download</a></dt>
<dd>Released on 2017/09/22
</dd>
<dd>Requires <a href="http://zenoss.com/product/zenpacks/pythoncollector">PythonCollector ZenPack</a>,<a href="http://zenoss.com/product/zenpacks/zenpacklib">ZenPackLib ZenPack</a>
</dd>
<dd>Compatible with Zenoss Resource Manager 5.2.x and 5.3.x
</dd>
</dl>
<h2>Contents</h2>
<div id="TOC">
<ul>
<li><a href="#background">Background</a><ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#gallery">Gallery</a></li>
</ul></li>
<li><a href="#features">Features</a><ul>
<li><a href="#nutanix-structure-and-discovery">Nutanix Structure and Discovery</a></li>
</ul></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#nutanix-batch-configuration">Nutanix Batch Configuration</a></li>
</ul></li>
<li><a href="#installed-items">Installed Items</a><ul>
<li><a href="#configuration-and-zproperties">Configuration and zProperties</a></li>
<li><a href="#modeler-plugins">Modeler Plugins</a></li>
</ul></li>
<li><a href="#zenoss-analytics">Zenoss Analytics</a></li>
<li><a href="#service-impact-and-root-cause-analysis">Service Impact and Root Cause Analysis</a><ul>
<li><a href="#internal-impact-relationships-between-nutanix-components">Internal Impact Relationships between Nutanix Components</a></li>
<li><a href="#internal-impact-relationships-between-nutanix-components-1">Internal Impact Relationships between Nutanix Components</a></li>
</ul></li>
<li><a href="#changes">Changes</a></li>
</ul>
</div>
<h2 id="background">Background</h2>
<p>This ZenPack monitors the Nutanix hyperconverged infrastructure environment.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Nutanix (5.0 or newer)</li>
<li>Nutanix API V1/V2</li>
<li>Prism API credentials</li>
<li>ZenPackLib ZenPack 2.0.8+</li>
</ul>
<h3 id="gallery">Gallery</h3>
<p><a href="images/NutanixCVMs.png" class="gallery" title="Nutanix CVMs"><img src="images/NutanixCVMs.png" title="Nutanix CVMs" class="gallery" /></a> <a href="images/NutanixClusters.png" class="gallery" title="Nutanix Clusters"><img src="images/NutanixClusters.png" title="Nutanix Clusters" class="gallery" /></a> <a href="images/NutanixContainers.png" class="gallery" title="Nutanix Containers"><img src="images/NutanixContainers.png" title="Nutanix Containers" class="gallery" /></a> <a href="images/NutanixHardDisks.png" class="gallery" title="Nutanix Hard Disks"><img src="images/NutanixHardDisks.png" title="Nutanix Hard Disks" class="gallery" /></a> <a href="images/NutanixHosts.png" class="gallery" title="Nutanix Hosts"><img src="images/NutanixHosts.png" title="Nutanix Hosts" class="gallery" /></a> <a href="images/NutanixOverview.png" class="gallery" title="Nutanix Overview"><img src="images/NutanixOverview.png" title="Nutanix Overview" class="gallery" /></a> <a href="images/NutanixStoragePools.png" class="gallery" title="Nutanix Storage Pools"><img src="images/NutanixStoragePools.png" title="Nutanix Storage Pools" class="gallery" /></a> <a href="images/NutanixVMs.png" class="gallery" title="Nutanix VMs"><img src="images/NutanixVMs.png" title="Nutanix VMs" class="gallery" /></a> <a href="images/NutanixClasses.png" class="gallery" title="Nutanix Classes"><img src="images/NutanixClasses.png" title="Nutanix Classes" class="gallery" /></a> <a href="images/NutanixImpact.png" class="gallery" title="Nutanix Impact Relations"><img src="images/NutanixImpact.png" title="Nutanix Impact Relations" class="gallery" /></a> <a href="images/ImpactView.png" class="gallery" title="Nutanix Impact View"><img src="images/ImpactView.png" title="Nutanix Impact View" class="gallery" /></a></p>
<h2 id="features">Features</h2>
<p>Nutanix features include:</p>
<ul>
<li>Overall Cluster Health Monitoring</li>
<li>Health Monitoring for Clusters, Hosts, and CVMs</li>
<li>Graphs for key Nutanix settings and performance metrics</li>
<li>Service Impact and root cause analysis. (Requires Zenoss Service Dynamics)</li>
<li>Event Management</li>
</ul>
<h3 id="nutanix-structure-and-discovery">Nutanix Structure and Discovery</h3>
<p>Objects are automatically discovered via the Nutanix API. The ZenPack class structure can be visualized in the following Diagram:</p>
<figure>
<img src="images/NutanixClasses.png" alt="Nutanix ZP Class Structure" /><figcaption>Nutanix ZP Class Structure</figcaption>
</figure>
<h4 id="nutanix-device-nutanixendpoint">Nutanix Device (NutanixEndpoint)</h4>
<ul>
<li>Description: The Nutanix device, which can host multiple clusters.</li>
<li>Attributes: cluster_external_ipaddress, cluster_uuid, device_uuid, hypervisor_types, model_name, ncc_version, product_version, timezone</li>
<li>Relationships: nutanixClusters</li>
<li>Datasources:
<ul>
<li>events</li>
<li>alerts</li>
</ul></li>
</ul>
<h4 id="nutanix-clusters-nutanixcluster">Nutanix Clusters (NutanixCluster)</h4>
<ul>
<li>Description: The cluster component. Nutanix can host multiple clusters.</li>
<li>Attributes: cluster_external_ipaddress, cluster_uuid, num_hosts, operation_mode, storage_usage_pct, total_cpu, total_memory, total_storage, version</li>
<li>Relationships: nutanixEndpoint, nutanixCVMs, nutanixHosts, nutanixStoragePools, nutanixVMs, nutanixVdisks</li>
<li>Datapoints:
<ul>
<li>cluster:
<ul>
<li>operation_mode</li>
</ul></li>
<li>stats:
<ul>
<li>content_cache_hit_pct</li>
<li>controller_random_io_pct</li>
<li>controller_read_io_pct</li>
<li>controller_seq_io_pct</li>
<li>controller_write_io_pct</li>
<li>hypervisor_cpu_usage_pct</li>
<li>hypervisor_kvm_cpu_usage_pct</li>
<li>hypervisor_kvm_memory_usage_pct</li>
<li>hypervisor_memory_usage_pct</li>
<li>random_io_pct</li>
<li>read_io_pct</li>
<li>seq_io_pct</li>
<li>write_io_pct</li>
</ul></li>
<li>usagestats:
<ul>
<li>storage.capacity_bytes</li>
<li>storage.free_bytes</li>
<li>storage.usage_pct</li>
<li>storage_tier.das-sata.capacity_bytes</li>
<li>storage_tier.das-sata.free_bytes</li>
<li>storage_tier.das-sata.usage_pct</li>
<li>storage_tier.ssd.capacity_bytes</li>
<li>storage_tier.ssd.free_bytes</li>
<li>storage_tier.ssd.usage_pct</li>
</ul></li>
</ul></li>
<li>Graphs:
<ul>
<li>Controller IO</li>
<li>DAS Storage</li>
<li>Hypervisor CPU Utilization</li>
<li>Hypervisor Memory Utilization</li>
<li>IO</li>
<li>IO Cache Hit Ratio</li>
<li>SSD Storage</li>
<li>Storage Utilization</li>
</ul></li>
<li>Thresholds:
<ul>
<li>90 Percent Storage</li>
<li>95 Percent Storage</li>
<li>95 Percent hypervisor memory</li>
<li>98 Percent Controller IO</li>
<li>98 Percent Disk IO</li>
</ul></li>
</ul>
<h4 id="hosts-nutanixhost">Hosts (NutanixHost)</h4>
<ul>
<li>Description: Hosts that Nutanix services run on</li>
<li>Attributes: cluster_uuid, host_uuid, hypervisor_address, service_vmexternal_ip, cpu_capacity_in_hz, memory_capacity_in_bytes, hypervisor_version</li>
<li>Relationships: nutanixCluster, nutanixHardDisks</li>
<li>Datapoints:
<ul>
<li>host:
<ul>
<li>num_vms</li>
<li>state</li>
</ul></li>
<li>stats:
<ul>
<li>content_cache_hit_pct</li>
<li>controller_random_io_pct</li>
<li>controller_read_io_pct</li>
<li>controller_seq_io_pct</li>
<li>controller_write_io_pct</li>
<li>hypervisor_cpu_usage_pct</li>
<li>hypervisor_memory_usage_pct</li>
<li>random_io_pct</li>
<li>read_io_pct</li>
<li>seq_io_pct</li>
<li>write_io_pct</li>
</ul></li>
<li>usagestats:
<ul>
<li>storage.capacity_bytes</li>
<li>storage.free_bytes</li>
<li>storage.usage_pct</li>
<li>storage_tier.das-sata.capacity_bytes</li>
<li>storage_tier.das-sata.free_bytes</li>
<li>storage_tier.das-sata.usage_pct</li>
<li>storage_tier.ssd.capacity_bytes</li>
<li>storage_tier.ssd.free_bytes</li>
<li>storage_tier.ssd.usage_pct</li>
</ul></li>
</ul></li>
<li>Graphs:
<ul>
<li>Controller IO</li>
<li>DAS Storage</li>
<li>Hypervisor CPU Utilization</li>
<li>Hypervisor Memory Utilization</li>
<li>IO</li>
<li>IO Cache Hit Ratio</li>
<li>SSD Storage</li>
<li>Storage Utilization</li>
</ul></li>
<li>Thresholds:
<ul>
<li>90 Percent Storage</li>
<li>95 Percent Storage</li>
<li>95 Percent hypervisor cpu</li>
<li>95 Percent hypervisor memory</li>
<li>98 Percent Disk IO</li>
</ul></li>
</ul>
<h4 id="nutanixvmnutanixcvm">NutanixVM/NutanixCVM</h4>
<p>Nutanix CVMs and VMs have a very similar structure and we cover them together although they are completely distinct components.</p>
<ul>
<li>Description: Virtual Machines and Controller Virtual Machines</li>
<li>Attributes: cluster_uuid, host_uuid, ipAddresses, mac_addresses, memoryCapacityInBytes, network_uuids, nonNdfsDetails, num_vcpus, vdisk_uuids, vm_uuid</li>
<li>Relationships: nutanixCluster, nutanixVdisk</li>
<li>Datapoints:
<ul>
<li>stats:
<ul>
<li>guest.memory_usage_pct</li>
<li>hypervisor_cpu_usage_pct</li>
<li>random_io_pct</li>
<li>read_io_pct</li>
<li>seq_io_pct</li>
<li>write_io_pct</li>
</ul></li>
<li>vm:
<ul>
<li>powerState</li>
</ul></li>
</ul></li>
<li>Graphs:
<ul>
<li>CPU Utilization</li>
<li>IO</li>
<li>Memory Utilization</li>
</ul></li>
<li>Thresholds:
<ul>
<li>98 percent guest memory</li>
</ul></li>
</ul>
<h4 id="hard-disks-nutanixharddisk">Hard Disks (NutanixHardDisk)</h4>
<ul>
<li>Description: Physical hard disks used for VM storage</li>
<li>Attributes: cluster_uuid, disk_uuid, host_uuid, location, model, serial_number, size, storage_tier_name</li>
<li>Relationships: nutanixHost, nutanixStoragePool</li>
<li>Datapoints:
<ul>
<li>disk:
<ul>
<li>disk_status</li>
<li>online</li>
</ul></li>
<li>stats:
<ul>
<li>random_io_pct</li>
<li>read_io_pct</li>
<li>seq_io_pct</li>
<li>write_io_pct</li>
</ul></li>
<li>usagestats:
<ul>
<li>storage.capacity_bytes</li>
<li>storage.free_bytes</li>
<li>storage.usage_pct</li>
</ul></li>
</ul></li>
<li>Graphs:
<ul>
<li>IO</li>
<li>Storage Utilization</li>
</ul></li>
<li>Thresholds:
<ul>
<li>90 Percent Storage</li>
<li>95 Percent Storage</li>
</ul></li>
</ul>
<h4 id="storage-pools-nutanixstoragepool">Storage Pools (NutanixStoragePool)</h4>
<ul>
<li>Description: The Nutanix logical storage objects</li>
<li>Attributes: cluster_uuid, disk_uuids, free_bytes, size, storagepool_uuid, used_bytes</li>
<li>Relationships: nutanixContainers, nutanixHardDisks</li>
<li>Datapoints:
<ul>
<li>stats:
<ul>
<li>random_io_pct</li>
<li>read_io_pct</li>
<li>seq_io_pct</li>
<li>write_io_pct</li>
</ul></li>
<li>usagestats:
<ul>
<li>storage.capacity_bytes</li>
<li>storage.free_bytes</li>
<li>storage.usage_pct</li>
<li>storage_tier.das-sata.capacity_bytes</li>
<li>storage_tier.das-sata.free_bytes</li>
<li>storage_tier.das-sata.usage_pct</li>
<li>storage_tier.ssd.capacity_bytes</li>
<li>storage_tier.ssd.free_bytes</li>
<li>storage_tier.ssd.usage_pct</li>
</ul></li>
</ul></li>
<li>Graphs:
<ul>
<li>DAS Storage</li>
<li>IO</li>
<li>SSD Storage</li>
<li>Storage Utilization</li>
</ul></li>
<li>Thresholds:
<ul>
<li>90 Percent Storage</li>
<li>95 Percent Storage</li>
</ul></li>
</ul>
<h4 id="nutanix-storage-containers-nutanixcontainer">Nutanix Storage Containers (NutanixContainer)</h4>
<ul>
<li>Description: Storage containers sub-divide Nutanix storage pools.</li>
<li>Attributes: cluster_uuid, compressionEnabled, container_uuid, erasureCode, free_bytes, replicationFactor, size, storagepool_uuid, used_bytes</li>
<li>Relationships: nutanixStoragePool, nutanixVdisks</li>
<li>Datapoints:
<ul>
<li>stats:
<ul>
<li>random_io_pct</li>
<li>read_io_pct</li>
<li>seq_io_pct</li>
<li>write_io_pct</li>
</ul></li>
<li>usagestats:
<ul>
<li>storage.capacity_bytes</li>
<li>storage.free_bytes</li>
<li>storage.usage_pct</li>
<li>storage_tier.das-sata.usage_pct</li>
<li>storage_tier.ssd.usage_pct</li>
</ul></li>
</ul></li>
<li>Graphs:
<ul>
<li>DAS Usage</li>
<li>IO</li>
<li>SSD Usage</li>
<li>Storage Utilization</li>
</ul></li>
<li>Thresholds
<ul>
<li>90 Percent Storage</li>
<li>95 Percent Storage</li>
</ul></li>
</ul>
<h4 id="nutanix-virtual-disks-nutanixvdisk">Nutanix Virtual Disks (NutanixVdisk)</h4>
<ul>
<li>Description: Virtual disks existing inside a NutanixContainer.</li>
<li>Attributes: attached_vm_uuid, cluster_uuid, size, storage_container_uuid, vdisk_uuid</li>
<li>Relationships: nutanixCVM, nutanixCluster, nutanixContainer, nutanixVM</li>
<li>Datapoints:
<ul>
<li>stats:
<ul>
<li>random_io_pct</li>
<li>read_io_pct</li>
<li>seq_io_pct</li>
<li>write_io_pct</li>
</ul></li>
</ul></li>
<li>Graphs: IO</li>
</ul>
<h2 id="usage">Usage</h2>
<p>You must expose the Nutanix V1 and V2 APIs on your Prism system. Once you have the username and password, you can enter the device in Zenoss as follows:</p>
<ul>
<li>Go to Infrastructure Tab</li>
<li>From the Add Device pull-down, select <em>Add Nutanix Device</em>
<ul>
<li>Enter the hostname or IP address</li>
<li>Enter the username</li>
<li>Enter the password</li>
<li>Select the correct collector</li>
<li>Finally, click on <em>Add</em></li>
</ul></li>
<li>After modeling is complete you should see your device components</li>
<li>If modeling large numbers of components you may have to increase zCollectorClientTimeout well beyond 600 to avoid model timeout.</li>
</ul>
<h3 id="nutanix-batch-configuration">Nutanix Batch Configuration</h3>
<p>You can also add your devices in batch for convenience and automation.</p>
<ul>
<li><p>Attach to the Zope container:</p>
<pre><code>  serviced service attach zope</code></pre></li>
<li><p>Create a text file (filename: <code>/tmp/batch.txt</code>) as follows:</p>
<pre><code>  /Devices/Nutanix
  nutanix64 setManageIp=&#39;10.1.1.7&#39;, \
     zNutanixUsername=&#39;username&#39;, \
     zNutanixPassword=&#39;password&#39;</code></pre></li>
<li><p>Now run the zenbatchload command:</p>
<pre><code>  zenbatchload  /tmp/batch.txt</code></pre></li>
<li><p>The device should now load and model automatically</p></li>
</ul>
<h2 id="installed-items">Installed Items</h2>
<p>Installing this ZenPack will add the following items to your Zenoss system:</p>
<h3 id="configuration-and-zproperties">Configuration and zProperties</h3>
<p>The zProperties and default settings are as follows:</p>
<ul>
<li>zNutanixAlertsInterval: Interval to collect alerts; default 60 seconds</li>
<li>zNutanixEventsInterval: Interval to collect events; default 60 seconds</li>
<li>zNutanixPerfInterval: Interval to collect metric data; default 300 seconds</li>
<li>zNutanixUsername: API username</li>
<li>zNutanixPassword: API password</li>
<li>zNutanixPort: API port; default 9440</li>
<li>zNutanixUseSSL: API SSL boolean; default True</li>
</ul>
<h3 id="modeler-plugins">Modeler Plugins</h3>
<ul>
<li>zenoss.Nutanix</li>
</ul>
<h2 id="zenoss-analytics">Zenoss Analytics</h2>
<p>This ZenPack provides additional support for Zenoss Analytics. Perform the following steps to install extra reporting resources into Zenoss Analytics after installing the ZenPack.</p>
<ol>
<li>Copy analytics-bundle.zip from $ZENHOME/ZenPacks/ZenPacks.zenoss.Nutanix*/ZenPacks/zenoss/Nutanix/analytics/ on your Zenoss server.</li>
<li>Navigate to Zenoss Analytics in your browser.</li>
<li>Login as superuser.</li>
<li><p>Remove any existing <em>Nutanix_ZenPack</em> folder.</p>
<blockquote>
<ol>
<li>Choose <em>Repository</em> from the <em>View</em> menu at the top of the page.</li>
<li>Expand <em>Public</em> in the list of folders.</li>
<li>Right-click on <em>Nutanix_ZenPack</em> folder and choose <em>Delete</em>.</li>
<li>Confirm deletion by clicking <em>OK</em>.</li>
</ol>
</blockquote></li>
<li><p>Add the new <em>Nutanix_ZenPack</em> folder.</p>
<blockquote>
<ol>
<li>Choose <em>Server Settings</em> from the ''Manage' menu at the top of the page.</li>
<li>Choose <em>Import</em> in the left page.</li>
<li>Remove checks from all check boxes.</li>
<li>Click <em>Choose File</em> to import a data file.</li>
<li>Choose the analytics-bundle.zip file copied from your Zenoss server.</li>
<li>Click <em>Import</em>.</li>
</ol>
</blockquote></li>
</ol>
<p>You can now navigate back to the <em>Nutanix_ZenPack</em> folder in the repository to see the following resources added by the bundle.</p>
<p>Domains</p>
<ul>
<li>Nutanix Domain</li>
</ul>
<p>Domains can be used to create ad hoc views using the following steps.</p>
<ol>
<li>Choose <em>Ad Hoc View</em> from the <em>Create</em> menu.</li>
<li>Click <em>Domains</em> at the top of the data chooser dialog.</li>
<li>Expand <em>Public</em> then <em>Nutanix ZenPack</em>.</li>
<li>Choose the <em>Nutanix Domain</em> domain</li>
</ol>
<h2 id="service-impact-and-root-cause-analysis">Service Impact and Root Cause Analysis</h2>
<p>When combined with the Zenoss Service Dynamics product, this ZenPack adds built-in service impact and root cause analysis capabilities. The service impact relationships shown in the diagram (right) and described below are automatically added and maintained. These will be included in any services that contain one or more of the explicitly mentioned components.</p>
<p>The following objects types would typically be added to Impact services.</p>
<ul>
<li>NutanixVM</li>
<li>Linux or Windows devices associated with a NutanixVM</li>
</ul>
<figure>
<img src="images/NutanixImpact.png" alt="Impact Relationship Diagram" /><figcaption>Impact Relationship Diagram</figcaption>
</figure>
<h3 id="internal-impact-relationships-between-nutanix-components">Internal Impact Relationships between Nutanix Components</h3>
<ul>
<li>NutanixEndpoint: impacts all NutanixHosts.</li>
<li>NutanixCluster: impacts NutanixVMs, NutanixStoragePools</li>
<li>NutanixHost: impacts NutanixCVMs</li>
<li>NutanixCVM: impacts NutanixCluster</li>
<li>NutanixHardDisk: impacts NutanixStoragePool</li>
<li>NutanixStoragePool: impacts NutanixContainers</li>
<li>NutanixContainers: impacts NutanixVdisks</li>
<li>NutanixVdisks: impacts NutanixVM</li>
</ul>
<h3 id="internal-impact-relationships-between-nutanix-components-1">Internal Impact Relationships between Nutanix Components</h3>
<ul>
<li>NutanixVM: impacts: GuestDevice (the hosted Linux or Windows system)</li>
</ul>
<figure>
<img src="images/ImpactView.png" alt="Impact View Diagram" /><figcaption>Impact View Diagram</figcaption>
</figure>
<h2 id="changes">Changes</h2>
<p>1.0.1</p>
<ul>
<li>Add debug info for modeler (ZPS-2310)</li>
<li>Guard for missing disk hw info (ZPS-2311)</li>
<li>Extend zCollectorClientTimeout to 600, optimize modeling (ZPS-2316, ZPS-2430)</li>
<li>Tested with Zenoss Resource Manager 5.3.2 &amp; 6.0.0, Service Impact 5.2.2, Analytics 5.0.8</li>
</ul>
<p>1.0.0</p>
<ul>
<li>Initial Release</li>
<li>Tested with Zenoss Resource Manager 5.2.6 &amp; 5.3.1, Service Impact 5.1.7, Analytics 5.0.8</li>
</ul>
